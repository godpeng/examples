<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>chris</title>
		<script src="libs/flwebgl-0.2.min.js"></script>
		<script src="assets/chris_actions.js"></script>
		<script>
			var player, result = flwebgl.Player.S_OK;
			var atlasList = [], content = undefined;

			function loadContent() {
				getAsset("assets/chris.json", function (response) {content = JSON.parse(response); assetLoaded(); });
				getAsset("assets/chris_atlas.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas2.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas2.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas3.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas3.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas4.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas4.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas5.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas5.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas6.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas6.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas7.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas7.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas8.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas8.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas9.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas9.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas10.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas10.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas11.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas11.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas12.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas12.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas13.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas13.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas14.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas14.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas15.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas15.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas16.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas16.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas17.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas17.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas18.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas18.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas19.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas19.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas20.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas20.png"}); assetLoaded(); });
				getAsset("assets/chris_atlas21.json", function (response) { atlasList.push({json:JSON.parse(response), image:"assets/chris_atlas21.png"}); assetLoaded(); });
			}

			function assetLoaded() {
				if (atlasList.length == 21 && content) {
					var canvas = document.getElementById("canvas");
					player = new flwebgl.Player();

					//Create textureatlas object for all the textures which you have
					var textureAtlasList = [];
					for (var i = 0; i < atlasList.length; i++) {
						textureAtlasList.push(new flwebgl.TextureAtlas(atlasList[i].json, atlasList[i].image));
					}

					result = player.init(canvas, content, textureAtlasList, handleComplete);

					if(result === flwebgl.Player.E_CONTEXT_CREATION_FAILED) {
						document.getElementById("err_nowebglsupport").style.display="block";
						return;
					} else if(result === flwebgl.Player.E_REQUIRED_EXTENSION_NOT_PRESENT) {
						document.getElementById("err_extensionnotpresent").style.display="block";
						return;
					}

					//Resize the canvas and reset the viewport
					var w = player.getStageWidth();
					var h = player.getStageHeight();
					canvas.width = w;
					canvas.height = h;
					player.setViewport(new flwebgl.geom.Rect(0, 0, w, h));

					
					if(player.getStage())
					{
						player.getStage().addEventListener(flwebgl.events.Event.REMOVED, function(evt){
							if( evt && evt.getTarget() && evt.getTarget().getName() === "___camera___instance" )
								player.getStage().setLocalTransform(new flwebgl.geom.Matrix());
						});
						player.getStage().addEventListener(flwebgl.events.Event.ENTER_FRAME, function(evt) {
							var stage = player.getStage();
							var cameraInstance = stage.getChildAt(0);
							if(cameraInstance && cameraInstance.getName() === "___camera___instance")
							{
								var mat = cameraInstance.getLocalTransform();
								var bounds = cameraInstance.getBounds();
								var stageCenterX = Math.round(bounds.width)/2;
								var stageCenterY = Math.round(bounds.height)/2;
								var inverseMat = mat.invert();
								inverseMat.translate(stageCenterX, stageCenterY);
								stage.setLocalTransform(inverseMat);
								stage.setLocalColorTransform(cameraInstance.getLocalColorTransform());
							}
						});
					}
				}
			}

			function getAsset(url, callbk) {
				if (!window.XMLHttpRequest) {
					document.getElementById("err_nowebglsupport").style.display="block";
					return;
				}

				var req = new XMLHttpRequest();
				req.onreadystatechange = function() {
					if (req.readyState == 4 && req.status == 200)
						callbk(req.responseText);
				};
				req.open("GET", url, true);
				req.send();
			}

			function handleComplete() {
				if(result === flwebgl.Player.S_OK) {
					player.play();

					// ==> This is a good place to add code <==
				}
			}
		</script>
	</head>
	<body onload="loadContent();">
		<canvas id="canvas" style="border: none;"></canvas>
		<div class="error" id="err_nowebglsupport" style="display:none;"><span>Your browser does not support WebGL.</span>&nbsp;<span><a href="http://get.webgl.org">Check WebGL support.</a></span></div>
		<div class="error" id="err_extensionnotpresent" style="display:none;">A required WebGL extension is not supported by your browser.</div>
	</body>
</html>
